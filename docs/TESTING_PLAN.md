# –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ï–ì–†–Æ–õ/–ï–ì–†–ò–ü

## –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–π –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π.

**–¶–µ–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞:
1. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ Kafka
3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ Notification Service
4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø–æ–¥–ø–∏—Å–æ–∫
5. –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —à–∞–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–≤ DRY RUN —Ä–µ–∂–∏–º–µ)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  XML Import ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ1‚îÄ‚îÄ‚îÄ>‚îÇ ClickHouse Cluster ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ2‚îÄ‚îÄ‚îÄ>‚îÇ Change   ‚îÇ
‚îÇ  (Parquet)  ‚îÇ         ‚îÇ (companies/        ‚îÇ         ‚îÇ Detection‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ  entrepreneurs)    ‚îÇ         ‚îÇ Service  ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                              ‚îÇ
                                    3. Kafka events           ‚ñº
                                    (company-changes)   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                                        ‚îÇ  Kafka   ‚îÇ
                                                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                              ‚îÇ
                                    4. Consumer               ‚ñº
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ Notification Service                   ‚îÇ
                        ‚îÇ - –ß–∏—Ç–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ –∏–∑ PostgreSQL        ‚îÇ
                        ‚îÇ - –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ change_filters          ‚îÇ
                        ‚îÇ - –õ–æ–≥–∏—Ä—É–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (DRY RUN)       ‚îÇ
                        ‚îÇ - –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ notification_log        ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –¢–∏–ø—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π (change_type)

### –ö–æ–º–ø–∞–Ω–∏–∏ (COMPANY):
- **status** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ (–∞–∫—Ç–∏–≤–µ–Ω, –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω, –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏)
- **director** - —Å–º–µ–Ω–∞ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è
- **founder_added** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á—Ä–µ–¥–∏—Ç–µ–ª—è
- **founder_removed** - —É–¥–∞–ª–µ–Ω–∏–µ —É—á—Ä–µ–¥–∏—Ç–µ–ª—è
- **founder_share_change** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–æ–ª–∏ —É—á—Ä–µ–¥–∏—Ç–µ–ª—è
- **address** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞
- **capital** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–≤–Ω–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞
- **activity_added** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–û–ö–í–≠–î)
- **activity_removed** - —É–¥–∞–ª–µ–Ω–∏–µ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **main_activity_change** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –û–ö–í–≠–î

### –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏ (ENTREPRENEUR):
- **status** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
- **address** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞
- **activity_added** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **activity_removed** - —É–¥–∞–ª–µ–Ω–∏–µ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **main_activity_change** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –û–ö–í–≠–î

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 1. –í–∫–ª—é—á–µ–Ω–∏–µ DRY RUN —Ä–µ–∂–∏–º–∞

–í —Ñ–∞–π–ª–µ `.env.development` (–∏–ª–∏ `.env`) —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:

```bash
EMAIL_DRY_RUN=true
```

–≠—Ç–æ –≤–∫–ª—é—á–∏—Ç —Ä–µ–∂–∏–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ email.

### 2. –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```bash
# –ó–∞–ø—É—Å–∫ —Å Kafka –∏ notification services
make up

# –ò–ª–∏ —á–µ—Ä–µ–∑ docker compose
docker compose --profile full up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose ps
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ —Å—Ç–∞—Ç—É—Å–µ "Up":
- postgres
- clickhouse-01 ... clickhouse-06 (–∫–ª–∞—Å—Ç–µ—Ä ClickHouse)
- keeper-01, keeper-02, keeper-03 (ClickHouse Keeper)
- elasticsearch
- redis
- kafka
- zookeeper
- api-gateway
- search-service
- change-detection-service
- notification-service
- frontend
- mailhog (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Kafka topics

```bash
# –°–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤
docker compose exec kafka kafka-topics --list --bootstrap-server localhost:9092

# –î–æ–ª–∂–Ω—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å:
# - company-changes
# - entrepreneur-changes
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ PostgreSQL —Å—Ö–µ–º—ã subscriptions

```bash
docker compose exec postgres psql -U postgres -d egrul -c "\dt subscriptions.*"

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# entity_subscriptions
# notification_log
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ ClickHouse —Ç–∞–±–ª–∏—Ü –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
docker compose exec clickhouse-01 clickhouse-client --query "SHOW TABLES FROM egrul LIKE '%changes%'"

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# company_changes
# entrepreneur_changes
```

## –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–º–ø–∞–Ω–∏–∏

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–º–ø–∞–Ω–∏–∏ —Å "active" –Ω–∞ "liquidated".

#### –®–∞–≥ 1.1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ UI

```bash
# –û—Ç–∫—Ä—ã—Ç—å frontend
open http://localhost:3000

# 1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Watchlist
open http://localhost:3000/watchlist

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–∫–∞–∑–∞–Ω–Ω—ã–π email: test-status@example.com

# 3. –ù–∞–π—Ç–∏ –∫–æ–º–ø–∞–Ω–∏—é —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫
# –ù–∞–ø—Ä–∏–º–µ—Ä, –û–ì–†–ù: 1234567890123 (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π –û–ì–†–ù –∏–∑ –≤–∞—à–∏—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

# 4. –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –∫–æ–º–ø–∞–Ω–∏–∏
open http://localhost:3000/company/1234567890123

# 5. –ù–∞–∂–∞—Ç—å "–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
# 6. –í—ã–±—Ä–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã:
#    - [‚úì] –°—Ç–∞—Ç—É—Å
#    - [ ] –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å
#    - [ ] –£—á—Ä–µ–¥–∏—Ç–µ–ª–∏
#    - [ ] –ê–¥—Ä–µ—Å
#    - [ ] –ö–∞–ø–∏—Ç–∞–ª
#    - [ ] –í–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
# 7. –ù–∞–∂–∞—Ç—å "–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è"
```

#### –®–∞–≥ 1.2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ –ë–î

```bash
docker compose exec postgres psql -U postgres -d egrul <<'EOF'
SELECT
    id,
    user_email,
    entity_type,
    entity_id,
    entity_name,
    is_active,
    change_filters->'status' AS filter_status
FROM subscriptions.entity_subscriptions
WHERE user_email = 'kmakeev@arbitr.ru';
EOF
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
id      | user_email             | entity_type | entity_id     | entity_name | is_active | filter_status
--------+------------------------+-------------+---------------+-------------+-----------+--------------
uuid... | test-status@example... | company     | 1234567890123 | –û–û–û –¢–ï–°–¢    | t         | true
```

#### –®–∞–≥ 1.3: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–í–∞—Ä–∏–∞–Ω—Ç A: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ XML —Ñ–∞–π–ª–∞**

```bash
# 1. –ù–∞–π—Ç–∏ XML —Ñ–∞–π–ª –∫–æ–º–ø–∞–Ω–∏–∏ –≤ test/ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
find test/ -name "*.xml" | head -1

# 2. –°–¥–µ–ª–∞—Ç—å –∫–æ–ø–∏—é —Ñ–∞–π–ª–∞
cp test/example_company.xml test/example_company_updated.xml

# 3. –û—Ç–∫—Ä—ã—Ç—å test/example_company_updated.xml –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
# 4. –ù–∞–π—Ç–∏ —Å–µ–∫—Ü–∏—é <–°–≤–°—Ç–∞—Ç> (—Å—Ç–∞—Ç—É—Å)
# 5. –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–¥ —Å—Ç–∞—Ç—É—Å–∞:
#    –ë—ã–ª–æ: <–°–≤–°—Ç–∞—Ç –ö–æ–¥–°–æ—Å—Ç="1" –ù–∞–∏–º–°–æ—Å—Ç="–î–ï–ô–°–¢–í–£–Æ–©–ï–ï"/>
#    –°—Ç–∞–ª–æ: <–°–≤–°—Ç–∞—Ç –ö–æ–¥–°–æ—Å—Ç="9" –ù–∞–∏–º–°–æ—Å—Ç="–ü–†–ï–ö–†–ê–©–ï–ù–ê"/>
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤**

```bash
# –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
ls -la test/changed_data/
```

#### –®–∞–≥ 1.4: –ü–∞—Ä—Å–∏–Ω–≥ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–≥–æ XML

```bash
# –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
make parser-run INPUT=test/example_company_updated.xml OUTPUT=./output_updated
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úì Parsed 1 companies
‚úì Output: ./output_updated/egrul_part_001.parquet
```

#### –®–∞–≥ 1.5: –ò–º–ø–æ—Ä—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```bash
# –ò–º–ø–æ—Ä—Ç Parquet –≤ ClickHouse
make cluster-import DATA_DIR=./output_updated

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
DATA_DIR=./output_updated ./infrastructure/scripts/import-data.sh
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
[INFO] –ó–∞–≥—Ä—É–∑–∫–∞ ./output_updated/egrul_part_001.parquet –≤ —Ç–∞–±–ª–∏—Ü—É companies...
[SUCCESS] –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ
[SUCCESS] –ò–º–ø–æ—Ä—Ç –ï–ì–†–Æ–õ –∑–∞–≤–µ—Ä—à–µ–Ω:
  ‚Üí –ö–æ–º–ø–∞–Ω–∏–π: 1
```

#### –®–∞–≥ 1.6: –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ):**
Change Detection Service –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—É—é –∏ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –¥–∞–Ω–Ω—ã—Ö.

**–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

```bash
# –í—ã–∑–æ–≤ Change Detection Service API
curl -X POST http://localhost:8082/detect \
  -H "Content-Type: application/json" \
  -d '{
    "entity_type": "company",
    "entity_ids": ["1140280036192"]
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "success": true,
  "detected_changes": 1,
  "message": "Change detection completed"
}
```

#### –®–∞–≥ 1.7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ ClickHouse

```bash
docker compose exec clickhouse-01 clickhouse-client --query "
SELECT
    ogrn,
    company_name,
    change_type,
    field_name,
    old_value,
    new_value,
    is_significant,
    detected_at
FROM company_changes
WHERE ogrn = '1140280036192'
ORDER BY detected_at DESC
LIMIT 5
FORMAT Vertical
"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Row 1:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
ogrn:           1234567890123
company_name:   –û–û–û –¢–ï–°–¢
change_type:    status
field_name:     status
old_value:      {"code": "1", "name": "–î–ï–ô–°–¢–í–£–Æ–©–ï–ï"}
new_value:      {"code": "9", "name": "–ü–†–ï–ö–†–ê–©–ï–ù–ê"}
is_significant: 1
detected_at:    2026-01-29 15:30:00
```

#### –®–∞–≥ 1.8: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ Kafka

```bash
# –ß—Ç–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ —Ç–æ–ø–∏–∫–∞ company-changes
docker compose exec kafka kafka-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic company-changes \
  --from-beginning \
  --max-messages 1 \
  --property print.timestamp=true \
  --property print.key=true
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "change_id": "uuid-here",
  "entity_type": "company",
  "entity_id": "1234567890123",
  "entity_name": "–û–û–û –¢–ï–°–¢",
  "change_type": "status",
  "field_name": "status",
  "old_value": "{\"code\": \"1\", \"name\": \"–î–ï–ô–°–¢–í–£–Æ–©–ï–ï\"}",
  "new_value": "{\"code\": \"9\", \"name\": \"–ü–†–ï–ö–†–ê–©–ï–ù–ê\"}",
  "is_significant": true,
  "detected_at": "2026-01-29T15:30:00Z"
}
```

#### –®–∞–≥ 1.9: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Notification Service

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ DRY RUN
docker compose logs -f notification-service | grep "DRY RUN"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "level": "info",
  "ts": "2026-01-29T15:30:15.123Z",
  "msg": "üîî [DRY RUN] Email notification (NOT SENT)",
  "to": "test-status@example.com",
  "subject": "‚ö†Ô∏è –í–∞–∂–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: –û–û–û –¢–ï–°–¢ - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞",
  "entity_type": "company",
  "entity_id": "1234567890123",
  "entity_name": "–û–û–û –¢–ï–°–¢",
  "change_type": "status",
  "field_name": "status",
  "old_value": "{\"code\": \"1\", \"name\": \"–î–ï–ô–°–¢–í–£–Æ–©–ï–ï\"}",
  "new_value": "{\"code\": \"9\", \"name\": \"–ü–†–ï–ö–†–ê–©–ï–ù–ê\"}",
  "is_significant": true,
  "change_id": "uuid-here",
  "subscription_id": "subscription-uuid"
}
```

#### –®–∞–≥ 1.10: –ü—Ä–æ–≤–µ—Ä–∫–∞ notification_log –≤ PostgreSQL

```bash
docker compose exec postgres psql -U postgres -d egrul <<'EOF'
SELECT
    id,
    entity_type,
    entity_name,
    change_type,
    channel,
    recipient,
    status,
    sent_at,
    created_at
FROM subscriptions.notification_log
WHERE recipient = 'test-status@example.com'
ORDER BY created_at DESC
LIMIT 5;
EOF
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
id   | entity_type | entity_name | change_type | channel | recipient              | status | sent_at             | created_at
-----+-------------+-------------+-------------+---------+------------------------+--------+---------------------+--------------------
uuid | company     | –û–û–û –¢–ï–°–¢    | status      | email   | test-status@example... | SENT   | 2026-01-29 15:30:15 | 2026-01-29 15:30:15
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω, –µ—Å–ª–∏ –≤ –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–∞ –∑–∞–ø–∏—Å—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –≤ notification_log –ø–æ—è–≤–∏–ª–∞—Å—å –∑–∞–ø–∏—Å—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º SENT

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–º–µ–Ω–∞ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è –∫–æ–º–ø–∞–Ω–∏–∏

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è –∫–æ–º–ø–∞–Ω–∏–∏.

#### –®–∞–≥ 2.1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

```bash
# 1. –û—Ç–∫—Ä—ã—Ç—å watchlist
open http://localhost:3000/watchlist

# 2. Email: test-director@example.com
# 3. –ù–∞–π—Ç–∏ –∫–æ–º–ø–∞–Ω–∏—é —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫
# 4. –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –∫–æ–º–ø–∞–Ω–∏–∏
# 5. –ù–∞–∂–∞—Ç—å "–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
# 6. –í—ã–±—Ä–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã:
#    - [ ] –°—Ç–∞—Ç—É—Å
#    - [‚úì] –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å
#    - [ ] –£—á—Ä–µ–¥–∏—Ç–µ–ª–∏
#    - [ ] –ê–¥—Ä–µ—Å
#    - [ ] –ö–∞–ø–∏—Ç–∞–ª
#    - [ ] –í–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```

#### –®–∞–≥ 2.2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ò–∑–º–µ–Ω–∏—Ç—å XML:
```xml
<!-- –ë—ã–ª–æ -->
<–°–≤–†—É–∫–û—Ä–≥>
  <–§–ò–û–†—É—Å –ò–ù–ù–§–õ="123456789012">
    <–§–∞–º–∏–ª–∏—è>–ò–≤–∞–Ω–æ–≤</–§–∞–º–∏–ª–∏—è>
    <–ò–º—è>–ò–≤–∞–Ω</–ò–º—è>
    <–û—Ç—á–µ—Å—Ç–≤–æ>–ò–≤–∞–Ω–æ–≤–∏—á</–û—Ç—á–µ—Å—Ç–≤–æ>
  </–§–ò–û–†—É—Å>
  <–î–æ–ª–∂–Ω–§–õ –ù–∞–∏–º–î–æ–ª–∂–Ω="–ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä"/>
</–°–≤–†—É–∫–û—Ä–≥>

<!-- –°—Ç–∞–ª–æ -->
<–°–≤–†—É–∫–û—Ä–≥>
  <–§–ò–û–†—É—Å –ò–ù–ù–§–õ="987654321098">
    <–§–∞–º–∏–ª–∏—è>–ü–µ—Ç—Ä–æ–≤</–§–∞–º–∏–ª–∏—è>
    <–ò–º—è>–ü–µ—Ç—Ä</–ò–º—è>
    <–û—Ç—á–µ—Å—Ç–≤–æ>–ü–µ—Ç—Ä–æ–≤–∏—á</–û—Ç—á–µ—Å—Ç–≤–æ>
  </–§–ò–û–†—É—Å>
  <–î–æ–ª–∂–Ω–§–õ –ù–∞–∏–º–î–æ–ª–∂–Ω="–ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä"/>
</–°–≤–†—É–∫–û—Ä–≥>
```

#### –®–∞–≥ 2.3-2.10: –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —à–∞–≥–∏ 1.3-1.10

**–û–∂–∏–¥–∞–µ–º—ã–π change_type:** `director`

**–û–∂–∏–¥–∞–µ–º—ã–π –ª–æ–≥:**
```json
{
  "msg": "üîî [DRY RUN] Email notification (NOT SENT)",
  "to": "test-director@example.com",
  "subject": "‚ö†Ô∏è –í–∞–∂–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: –û–û–û –¢–ï–°–¢ - –°–º–µ–Ω–∞ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è",
  "change_type": "director",
  "old_value": "{\"fullName\": \"–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á\", \"inn\": \"123456789012\"}",
  "new_value": "{\"fullName\": \"–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á\", \"inn\": \"987654321098\"}"
}
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á—Ä–µ–¥–∏—Ç–µ–ª—è

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—á—Ä–µ–¥–∏—Ç–µ–ª—è.

#### –®–∞–≥ 3.1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

–§–∏–ª—å—Ç—Ä—ã:
- [ ] –°—Ç–∞—Ç—É—Å
- [ ] –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å
- [‚úì] –£—á—Ä–µ–¥–∏—Ç–µ–ª–∏
- [ ] –ê–¥—Ä–µ—Å
- [ ] –ö–∞–ø–∏—Ç–∞–ª
- [ ] –í–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

Email: test-founders@example.com

#### –®–∞–≥ 3.2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–î–æ–±–∞–≤–∏—Ç—å –≤ XML —Å–µ–∫—Ü–∏—é –Ω–æ–≤–æ–≥–æ —É—á—Ä–µ–¥–∏—Ç–µ–ª—è:
```xml
<–£—á—Ä–Æ–õ–†–æ—Å>
  <–ù–∞–∏–º–ò–ù–ù–Æ–õ –û–ì–†–ù="9876543210987" –ò–ù–ù="9876543210" –ö–ü–ü="987601001">
    –û–û–û "–ù–û–í–´–ô –£–ß–†–ï–î–ò–¢–ï–õ–¨"
  </–ù–∞–∏–º–ò–ù–ù–Æ–õ>
  <–î–æ–ª—è–£—Å—Ç–ö–∞–ø –ù–æ–º–∏–Ω–°—Ç–æ–∏–º="50000" –†–∞–∑–º–µ—Ä–î–æ–ª–∏="25.00"/>
</–£—á—Ä–Æ–õ–†–æ—Å>
```

**–û–∂–∏–¥–∞–µ–º—ã–π change_type:** `founder_added`

**–û–∂–∏–¥–∞–µ–º—ã–π –ª–æ–≥:**
```json
{
  "change_type": "founder_added",
  "old_value": "null",
  "new_value": "{\"name\": \"–û–û–û –ù–û–í–´–ô –£–ß–†–ï–î–ò–¢–ï–õ–¨\", \"ogrn\": \"9876543210987\", \"share\": 25.0}"
}
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –∞–¥—Ä–µ—Å–∞.

#### –®–∞–≥ 4.1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

–§–∏–ª—å—Ç—Ä—ã:
- [ ] –°—Ç–∞—Ç—É—Å
- [ ] –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å
- [ ] –£—á—Ä–µ–¥–∏—Ç–µ–ª–∏
- [‚úì] –ê–¥—Ä–µ—Å
- [ ] –ö–∞–ø–∏—Ç–∞–ª
- [ ] –í–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

Email: test-address@example.com

#### –®–∞–≥ 4.2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ò–∑–º–µ–Ω–∏—Ç—å XML:
```xml
<!-- –ë—ã–ª–æ -->
<–ê–¥—Ä–µ—Å–†–§>
  <–ò–Ω–¥–µ–∫—Å>123456</–ò–Ω–¥–µ–∫—Å>
  <–ö–æ–¥–†–µ–≥–∏–æ–Ω>77</–ö–æ–¥–†–µ–≥–∏–æ–Ω>
  <–ì–æ—Ä–æ–¥>–ú–æ—Å–∫–≤–∞</–ì–æ—Ä–æ–¥>
  <–£–ª–∏—Ü–∞>–õ–µ–Ω–∏–Ω–∞</–£–ª–∏—Ü–∞>
  <–î–æ–º>1</–î–æ–º>
</–ê–¥—Ä–µ—Å–†–§>

<!-- –°—Ç–∞–ª–æ -->
<–ê–¥—Ä–µ—Å–†–§>
  <–ò–Ω–¥–µ–∫—Å>654321</–ò–Ω–¥–µ–∫—Å>
  <–ö–æ–¥–†–µ–≥–∏–æ–Ω>77</–ö–æ–¥–†–µ–≥–∏–æ–Ω>
  <–ì–æ—Ä–æ–¥>–ú–æ—Å–∫–≤–∞</–ì–æ—Ä–æ–¥>
  <–£–ª–∏—Ü–∞>–ü—É—à–∫–∏–Ω–∞</–£–ª–∏—Ü–∞>
  <–î–æ–º>99</–î–æ–º>
  <–ö–æ—Ä–ø—É—Å>–ê</–ö–æ—Ä–ø—É—Å>
</–ê–¥—Ä–µ—Å–†–§>
```

**–û–∂–∏–¥–∞–µ–º—ã–π change_type:** `address`

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–≤–Ω–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —É—Å—Ç–∞–≤–Ω–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞.

#### –®–∞–≥ 5.1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

–§–∏–ª—å—Ç—Ä—ã:
- [ ] –°—Ç–∞—Ç—É—Å
- [ ] –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å
- [ ] –£—á—Ä–µ–¥–∏—Ç–µ–ª–∏
- [ ] –ê–¥—Ä–µ—Å
- [‚úì] –ö–∞–ø–∏—Ç–∞–ª
- [ ] –í–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

Email: test-capital@example.com

#### –®–∞–≥ 5.2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ò–∑–º–µ–Ω–∏—Ç—å XML:
```xml
<!-- –ë—ã–ª–æ -->
<–°–≤–£—Å—Ç–ö–∞–ø –°—É–º–ö–∞–ø="100000.00" –ù–∞–∏–º–í–∞–ª—é—Ç="–†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å"/>

<!-- –°—Ç–∞–ª–æ -->
<–°–≤–£—Å—Ç–ö–∞–ø –°—É–º–ö–∞–ø="500000.00" –ù–∞–∏–º–í–∞–ª—é—Ç="–†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å"/>
```

**–û–∂–∏–¥–∞–µ–º—ã–π change_type:** `capital`

**–û–∂–∏–¥–∞–µ–º—ã–π –ª–æ–≥:**
```json
{
  "change_type": "capital",
  "old_value": "{\"amount\": 100000.00, \"currency\": \"RUB\"}",
  "new_value": "{\"amount\": 500000.00, \"currency\": \"RUB\"}",
  "is_significant": true
}
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 6: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–û–ö–í–≠–î)

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –û–ö–í–≠–î.

#### –®–∞–≥ 6.1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

–§–∏–ª—å—Ç—Ä—ã:
- [ ] –°—Ç–∞—Ç—É—Å
- [ ] –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å
- [ ] –£—á—Ä–µ–¥–∏—Ç–µ–ª–∏
- [ ] –ê–¥—Ä–µ—Å
- [ ] –ö–∞–ø–∏—Ç–∞–ª
- [‚úì] –í–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

Email: test-activities@example.com

#### –®–∞–≥ 6.2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–î–æ–±–∞–≤–∏—Ç—å –≤ XML –Ω–æ–≤—ã–π –û–ö–í–≠–î:
```xml
<–°–≤–û–ö–í–≠–î>
  <–°–≤–û–ö–í–≠–î–î–æ–ø>
    <–ö–æ–¥–û–ö–í–≠–î>62.01</–ö–æ–¥–û–ö–í–≠–î>
    <–ù–∞–∏–º–û–ö–í–≠–î>–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è</–ù–∞–∏–º–û–ö–í–≠–î>
  </–°–≤–û–ö–í–≠–î–î–æ–ø>
</–°–≤–û–ö–í–≠–î>
```

**–û–∂–∏–¥–∞–µ–º—ã–π change_type:** `activity_added`

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 7: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç–µ—Å—Ç)

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

#### –®–∞–≥ 7.1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

–í—ã–±—Ä–∞—Ç—å –í–°–ï —Ñ–∏–ª—å—Ç—Ä—ã:
- [‚úì] –°—Ç–∞—Ç—É—Å
- [‚úì] –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å
- [‚úì] –£—á—Ä–µ–¥–∏—Ç–µ–ª–∏
- [‚úì] –ê–¥—Ä–µ—Å
- [‚úì] –ö–∞–ø–∏—Ç–∞–ª
- [‚úì] –í–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

Email: test-all@example.com

#### –®–∞–≥ 7.2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ò–∑–º–µ–Ω–∏—Ç—å –≤ –æ–¥–Ω–æ–º XML —Ñ–∞–π–ª–µ:
1. –°—Ç–∞—Ç—É—Å (active ‚Üí liquidated)
2. –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è (–ò–≤–∞–Ω–æ–≤ ‚Üí –ü–µ—Ç—Ä–æ–≤)
3. –ê–¥—Ä–µ—Å (—É–ª. –õ–µ–Ω–∏–Ω–∞ ‚Üí —É–ª. –ü—É—à–∫–∏–Ω–∞)

#### –®–∞–≥ 7.3: –ü—Ä–æ–≤–µ—Ä–∫–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 3 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
```
üîî [DRY RUN] ... change_type: status
üîî [DRY RUN] ... change_type: director
üîî [DRY RUN] ... change_type: address
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 8: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

#### –®–∞–≥ 8.1: –°–æ–∑–¥–∞–Ω–∏–µ –¥–≤—É—Ö –ø–æ–¥–ø–∏—Å–æ–∫

**–ü–æ–¥–ø–∏—Å–∫–∞ 1:**
- Email: test-status-only@example.com
- –§–∏–ª—å—Ç—Ä—ã: [‚úì] –°—Ç–∞—Ç—É—Å —Ç–æ–ª—å–∫–æ

**–ü–æ–¥–ø–∏—Å–∫–∞ 2:**
- Email: test-director-only@example.com
- –§–∏–ª—å—Ç—Ä—ã: [‚úì] –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ

#### –®–∞–≥ 8.2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ò–∑–º–µ–Ω–∏—Ç—å –æ–±–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:
1. –°—Ç–∞—Ç—É—Å
2. –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å

#### –®–∞–≥ 8.3: –ü—Ä–æ–≤–µ—Ä–∫–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- `test-status-only@example.com` –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ —Å—Ç–∞—Ç—É—Å–µ
- `test-director-only@example.com` –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–≥–∞—Ö
docker compose logs notification-service | grep "test-status-only" | grep "status"
docker compose logs notification-service | grep "test-director-only" | grep "director"

# –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
docker compose logs notification-service | grep "test-status-only" | grep "director"  # EMPTY
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 9: –ù–µ–∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –¥–ª—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è.

#### –®–∞–≥ 9.1: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É —Å —Ñ–∏–ª—å—Ç—Ä–æ–º "–°—Ç–∞—Ç—É—Å"
# Email: test-inactive@example.com

# 2. –ü–µ—Ä–µ–π—Ç–∏ –≤ Watchlist
open http://localhost:3000/watchlist

# 3. –ù–∞–∂–∞—Ç—å "–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" –Ω–∞ –ø–æ–¥–ø–∏—Å–∫–µ
```

#### –®–∞–≥ 9.2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î

```bash
docker compose exec postgres psql -U postgres -d egrul <<'EOF'
SELECT is_active
FROM subscriptions.entity_subscriptions
WHERE user_email = 'test-inactive@example.com';
EOF

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: is_active = f (false)
```

#### –®–∞–≥ 9.3: –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞

–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —à–∞–≥–∏ –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ –°—Ü–µ–Ω–∞—Ä–∏—è 1.

#### –®–∞–≥ 9.4: –ü—Ä–æ–≤–µ—Ä–∫–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í –ª–æ–≥–∞—Ö –ù–ï–¢ –∑–∞–ø–∏—Å–∏ —Å `test-inactive@example.com`
- –í notification_log –ù–ï–¢ –∑–∞–ø–∏—Å–∏ –¥–ª—è —ç—Ç–æ–≥–æ email

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞
docker compose logs notification-service | grep "test-inactive@example.com"
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å EMPTY —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 10: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ò–ü (ENTREPRENEUR)

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø–æ–¥–ø–∏—Å–æ–∫ –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π.

#### –®–∞–≥ 10.1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

```bash
# 1. –ù–∞–π—Ç–∏ –ò–ü —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫
open http://localhost:3000

# 2. –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ò–ü
open http://localhost:3000/entrepreneur/123456789012345

# 3. –°–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
# Email: test-entrepreneur@example.com
# –§–∏–ª—å—Ç—Ä—ã: [‚úì] –°—Ç–∞—Ç—É—Å, [‚úì] –ê–¥—Ä–µ—Å, [‚úì] –í–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```

#### –®–∞–≥ 10.2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ò–∑–º–µ–Ω–∏—Ç—å XML —Ñ–∞–π–ª –ò–ü:
```xml
<!-- –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å -->
<–°–≤–°—Ç–∞—Ç—É—Å –ö–æ–¥–°—Ç–∞—Ç="1" –ù–∞–∏–º–°—Ç–∞—Ç="–î–ï–ô–°–¢–í–£–Æ–©–ò–ô"/> <!-- –ë—ã–ª–æ -->
<–°–≤–°—Ç–∞—Ç—É—Å –ö–æ–¥–°—Ç–∞—Ç="9" –ù–∞–∏–º–°—Ç–∞—Ç="–ü–†–ï–ö–†–ê–©–ï–ù–ê"/>  <!-- –°—Ç–∞–ª–æ -->
```

#### –®–∞–≥ 10.3: –ò–º–ø–æ—Ä—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

**–û–∂–∏–¥–∞–µ–º—ã–π change_type:** `status`
**–û–∂–∏–¥–∞–µ–º—ã–π entity_type:** `entrepreneur`

**Kafka topic:** `entrepreneur-changes`

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Kafka —Ç–æ–ø–∏–∫–∞
docker compose exec kafka kafka-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic entrepreneur-changes \
  --from-beginning \
  --max-messages 1
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

### –°–ª—É—á–∞–π 1: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ò–º–ø–æ—Ä—Ç –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ –¥–∞–Ω–Ω—ã—Ö –¥–≤–∞–∂–¥—ã –ø–æ–¥—Ä—è–¥.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ù–ï –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –±–ª–∞–≥–æ–¥–∞—Ä—è:
1. `change_id` –≤ ClickHouse (ReplacingMergeTree –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä—É–µ—Ç)
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ `notification_log` –ø–æ `change_event_id` –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# 1. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
make cluster-import DATA_DIR=./output_updated

# 2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ
make cluster-import DATA_DIR=./output_updated

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –ª–æ–≥–∞—Ö
docker compose logs notification-service | grep "DRY RUN" | grep "1234567890123" | wc -l
# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 1 (–Ω–µ 2!)
```

### –°–ª—É—á–∞–π 2: –ù–µ–∑–Ω–∞—á–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ –∫–∞–∫ –Ω–µ–∑–Ω–∞—á–∏–º–æ–µ (is_significant = false).

**–ü—Ä–∏–º–µ—Ä—ã –Ω–µ–∑–Ω–∞—á–∏–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –≤ –∞–¥—Ä–µ—Å–µ
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –û–ö–í–≠–î
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –∑–∞–ø–∏—Å–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—Ç–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
docker compose exec clickhouse-01 clickhouse-client --query "
SELECT
    change_type,
    is_significant,
    count() as cnt
FROM company_changes
GROUP BY change_type, is_significant
ORDER BY change_type, is_significant
"
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å—ë —Ä–∞–≤–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è, –Ω–æ —Å –æ–±—ã—á–Ω—ã–º subject (–±–µ–∑ ‚ö†Ô∏è)
- `"subject": "–ò–∑–º–µ–Ω–µ–Ω–∏–µ: –û–û–û –¢–ï–°–¢ - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞"` (–±–µ–∑ "–í–∞–∂–Ω–æ–µ")

### –°–ª—É—á–∞–π 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ —Å—É—â–Ω–æ—Å—Ç—å

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ò–º–ø–æ—Ä—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ `company_changes`
- –°–æ–±—ã—Ç–∏–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ Kafka
- Notification Service –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ, –Ω–æ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–¥–ø–∏—Å–æ–∫
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ù–ï –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –í –ª–æ–≥–∞—Ö Notification Service –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
docker compose logs notification-service | grep "no active subscriptions found"
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

#### 1. –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –í—Å–µ –ª–æ–≥–∏ —Å –º–µ—Ç–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f --timestamps

# –¢–æ–ª—å–∫–æ notification-service
docker compose logs -f notification-service

# –¢–æ–ª—å–∫–æ change-detection-service
docker compose logs -f change-detection-service

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É
docker compose logs -f | grep "DRY RUN"
docker compose logs -f | grep "ERROR"
```

#### 2. Kafka consumer lag

```bash
docker compose exec kafka kafka-consumer-groups \
  --bootstrap-server localhost:9092 \
  --describe \
  --group notification-service-group
```

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
- `LAG = 0` ‚Äî consumer –æ–±—Ä–∞–±–æ—Ç–∞–ª –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è (—Ö–æ—Ä–æ—à–æ)
- `LAG > 0` ‚Äî consumer –æ—Ç—Å—Ç–∞—ë—Ç –æ—Ç producer (–ø–ª–æ—Ö–æ, –Ω—É–∂–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

#### 3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ ClickHouse

```bash
docker exec egrul-clickhouse-01 clickhouse-client --user egrul_app --password test --query "SELECT
    change_type,
    count() as total,
    sum(is_significant) as significant_count,
    toDate(detected_at) as date
FROM egrul.company_changes
WHERE detected_at >= today() - 7
GROUP BY change_type, date
ORDER BY date DESC, total DESC
FORMAT Pretty"

```

#### 4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ PostgreSQL

```bash
docker compose exec postgres psql -U postgres -d egrul <<'EOF'
SELECT
    status,
    channel,
    count(*) as total
FROM subscriptions.notification_log
WHERE created_at >= NOW() - INTERVAL '1 day'
GROUP BY status, channel;
EOF
```

#### 5. –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏

```bash
docker compose exec postgres psql -U postgres -d egrul <<'EOF'
SELECT
    entity_type,
    count(*) as total_subscriptions,
    count(*) FILTER (WHERE is_active = true) as active,
    count(*) FILTER (WHERE is_active = false) as paused
FROM subscriptions.entity_subscriptions
GROUP BY entity_type;
EOF
```

---

## –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É email

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ DRY RUN —Ä–µ–∂–∏–º–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É.

### –®–∞–≥ 1: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–í `.env` —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
```bash
EMAIL_DRY_RUN=false

# –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π SMTP
SMTP_HOST=smtp.company.ru
SMTP_PORT=587
SMTP_USERNAME=notifications@company.ru
SMTP_PASSWORD=your-secure-password
SMTP_FROM=noreply@egrul.company.ru
SMTP_TLS=true
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Notification Service

```bash
docker compose restart notification-service

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker compose logs -f notification-service
```

**–û–∂–∏–¥–∞–µ–º—ã–π –ª–æ–≥:**
```
"msg": "Email channel initialized"
"dry_run": false  <-- –í–ê–ñ–ù–û: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å false
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –ø–æ–¥–ø–∏—Å–∫—É —Å –≤–∞—à–∏–º —Ä–µ–∞–ª—å–Ω—ã–º email –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∏–º–ø–æ—Ä—Ç —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í—ã –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.

---

## –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ production

- [ ] –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ 1-10 –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- [ ] –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] Consumer lag = 0 (–Ω–µ—Ç –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏—è)
- [ ] –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ—Ç –¥—É–±–ª–µ–π)
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Email —à–∞–±–ª–æ–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (HTML + text)
- [ ] notification_log –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] SMTP credentials –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è production
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ ClickHouse:
```bash
docker compose exec clickhouse-01 clickhouse-client --query \
  "SELECT count() FROM company_changes WHERE toDate(detected_at) = today()"
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Kafka —Å–æ–±—ã—Ç–∏—è:
```bash
docker compose exec kafka kafka-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic company-changes \
  --from-beginning \
  --max-messages 10
```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Notification Service:
```bash
docker compose logs notification-service | tail -100
```

### –ü—Ä–æ–±–ª–µ–º–∞: Consumer lag —Ä–∞—Å—Ç—ë—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** Notification Service –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è.

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ consumer –≤ –≥—Ä—É–ø–ø–µ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å `change_id` –≤ ClickHouse
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ `notification_log` –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Kafka offset commit

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –ø–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–æ–∫:
1. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ UI
2. ‚úÖ –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
3. ‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –≤ Kafka
4. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π Notification Service
5. ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ DRY RUN)
6. ‚úÖ –ó–∞–ø–∏—Å—å –≤ notification_log

–í—Å–µ 10 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –ø–æ–¥–ø–∏—Å–æ–∫.

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É
2. –ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ç–∞–±–ª–∏—Ü—É
3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
4. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
5. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É email
