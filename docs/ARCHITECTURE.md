# Архитектура системы ЕГРЮЛ/ЕГРИП

## Обзор

Система состоит из нескольких компонентов, каждый из которых отвечает за свою область:

## Компоненты

### 1. Parser (Rust)

**Назначение:** Парсинг XML файлов ЕГРЮЛ/ЕГРИП из ФНС

**Технологии:**
- Rust 2021 Edition
- quick-xml для парсинга XML
- serde для сериализации
- tokio для асинхронности
- clap для CLI

**Функционал:**
- Парсинг XML файлов ЕГРЮЛ (юр. лица)
- Парсинг XML файлов ЕГРИП (ИП)
- Конвертация в JSON/CSV
- Пакетная обработка директорий

### 2. API Gateway (Go)

**Назначение:** Единая точка входа для всех API запросов

**Технологии:**
- Go 1.23
- Gin Web Framework
- zerolog для логирования

**Функционал:**
- RESTful API
- Маршрутизация запросов
- Аутентификация (TODO)
- Rate limiting (TODO)

### 3. Search Service (Go)

**Назначение:** Полнотекстовый поиск по данным

**Технологии:**
- Go 1.23
- Elasticsearch 8.x клиент

**Функционал:**
- Индексация документов
- Полнотекстовый поиск
- Фильтрация и агрегация

### 4. Frontend (Next.js)

**Назначение:** Веб-интерфейс для пользователей

**Технологии:**
- Next.js 15
- React 19
- TailwindCSS
- TanStack Query
- Zustand

**Функционал:**
- Поиск организаций и ИП
- Просмотр карточек
- Аналитика (TODO)

## База данных

### PostgreSQL

Основное хранилище структурированных данных.

**Схемы:**
- `egrul.legal_entities` - юридические лица
- `egrul.entrepreneurs` - индивидуальные предприниматели
- `egrul.addresses` - адреса
- `egrul.activities` - виды деятельности (ОКВЭД)
- `egrul.capitals` - уставный капитал
- `egrul.heads` - руководители
- `egrul.founders` - учредители

### Elasticsearch

Индекс для полнотекстового поиска.

**Индексы:**
- `legal_entities` - юр. лица
- `entrepreneurs` - ИП

### Redis

Кэширование и сессии (TODO).

## Потоки данных

```
┌──────────────────────────────────────────────────────────────┐
│                    Загрузка данных                           │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  XML файлы ──► Parser (Rust) ──► JSON ──► PostgreSQL        │
│       ФНС                                    │               │
│                                              ▼               │
│                                      Elasticsearch           │
│                                                              │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│                    Запросы пользователей                     │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  Browser ──► Frontend ──► API Gateway ──► Services          │
│                                │               │             │
│                                │               ▼             │
│                                │         PostgreSQL          │
│                                │               │             │
│                                ▼               ▼             │
│                          Search Service ◄── Elasticsearch   │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

## Развертывание

### Локальная разработка

Используется Docker Compose для запуска всех сервисов.

### Production (TODO)

- Kubernetes
- Helm charts
- GitOps с ArgoCD

