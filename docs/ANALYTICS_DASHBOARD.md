# –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –¥–∞—à–±–æ—Ä–¥ –ï–ì–†–Æ–õ/–ï–ì–†–ò–ü

## –û–±–∑–æ—Ä

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü–∞—Ö –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—è—Ö —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤.

**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- üìä KPI –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ (10 –∫–∞—Ä—Ç–æ—á–µ–∫: 5 –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–π + 5 –¥–ª—è –ò–ü)
- üó∫Ô∏è –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Ç–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ —Ä–µ–≥–∏–æ–Ω–æ–≤ –†–æ—Å—Å–∏–∏ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º
- üìà –ì—Ä–∞—Ñ–∏–∫ –¥–∏–Ω–∞–º–∏–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –∏ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–π
- üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ–≥–∏–æ–Ω—É, –û–ö–í–≠–î, –ø–µ—Ä–∏–æ–¥—É (–≤—ã–±–æ—Ä –º–µ—Å—è—Ü–µ–≤)
- üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ localStorage
- ‚ö° –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (5 –º–∏–Ω—É—Ç)

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

### Frontend
- **React 19** + **Next.js 15** (App Router) - —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º React Hydration Error —á–µ—Ä–µ–∑ useEffect
- **Apache ECharts** - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ –∫–∞—Ä—Ç —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º
- **TanStack Query** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **Radix UI** - UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **Tailwind CSS** - —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è
- **date-fns** - —Ä–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏

### Backend
- **GraphQL** (gqlgen) - API —Å–ª–æ–π
- **ClickHouse Cluster** - –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –ë–î —Å Materialized Views
- **Go** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### Backend: Materialized Views

–î–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–µ–¥–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ Materialized Views –≤ ClickHouse:

1. **stats_companies_by_region** - –∞–≥—Ä–µ–≥–∞—Ü–∏—è –∫–æ–º–ø–∞–Ω–∏–π –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º –∏ —Å—Ç–∞—Ç—É—Å–∞–º
2. **stats_entrepreneurs_by_region** - –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ò–ü –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º –∏ —Å—Ç–∞—Ç—É—Å–∞–º
3. **stats_registrations_by_month** - –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
4. **stats_terminations_by_month** - –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥ –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `AggregatingMergeTree` (–±–µ–∑ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –•—Ä–∞–Ω–∏—Ç –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (`countState()`)
- –ß—Ç–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `countMerge()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

**–ú–∏–≥—Ä–∞—Ü–∏–∏:**
- `013_update_mv_status_logic.sql` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤
- `018_fix_terminations_mv_logic.sql` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–π (COALESCE + status_code)

### –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤

#### –ö–æ–º–ø–∞–Ω–∏–∏ (–ï–ì–†–Æ–õ)

–õ–æ–≥–∏–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `company-status-badge.tsx`:

```sql
multiIf(
    -- –ë–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–æ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ —á–µ–º –ø—Ä–æ—Å—Ç–æ –ª–∏–∫–≤–∏–¥–∞—Ü–∏—è)
    status_code IN ('113', '114', '115', '116', '117'), 'bankrupt',

    -- –õ–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–∞
    termination_date IS NOT NULL OR
    status_code IN ('101', '105', '106', '107', '113', '114', '115',
                    '116', '117', '701', '702', '801', '802'), 'liquidated',

    -- –ê–∫—Ç–∏–≤–Ω–∞—è (–≤–∫–ª—é—á–∞—è —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é 121-139)
    'active'
) as status
```

**–°—Ç–∞—Ç—É—Å—ã:**
- `active` - –Ω–µ—Ç termination_date –ò –∫–æ–¥ –ù–ï –≤ —Å–ø–∏—Å–∫–µ –Ω–µ–¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö
- `liquidated` - –µ—Å—Ç—å termination_date –ò–õ–ò –∫–æ–¥ –Ω–µ–¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö (101, 105-107, 701-702, 801-802)
- `bankrupt` - –∫–æ–¥—ã –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞ (113-117), –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ liquidated

#### –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏ (–ï–ì–†–ò–ü)

–õ–æ–≥–∏–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `entrepreneur-status-badge.tsx`:

```sql
if(
    termination_date IS NULL AND status_code IS NULL,
    'active',
    'liquidated'
) as status
```

**–°—Ç–∞—Ç—É—Å—ã:**
- `active` - –ù–ï–¢ termination_date –ò –ù–ï–¢ status_code (NULL)
- `liquidated` - –ï–°–¢–¨ termination_date –ò–õ–ò –ï–°–¢–¨ –ª—é–±–æ–π status_code

### GraphQL API

**Endpoint:** `http://localhost:8080/graphql`

#### –ù–æ–≤—ã–µ —Ç–∏–ø—ã

```graphql
"""
–¢–æ—á–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏)
"""
type TimeSeriesPoint {
  month: Date!
  registrationsCount: Int!
  terminationsCount: Int!
  netGrowth: Int!
}

"""
–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞
"""
type DashboardStatistics {
  # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã
  registrationsByMonth(dateFrom: Date, dateTo: Date): [TimeSeriesPoint!]!

  # –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã (–í–°–ï —Ä–µ–≥–∏–æ–Ω—ã)
  regionHeatmap: [RegionStatistics!]!
}
```

#### Query

```graphql
query GetDashboardStatistics($filter: StatsFilter) {
  dashboardStatistics(filter: $filter) {
    registrationsByMonth(dateFrom: $filter.dateFrom, dateTo: $filter.dateTo) {
      month
      registrationsCount
      terminationsCount
      netGrowth
    }
    regionHeatmap {
      regionCode
      regionName
      companiesCount
      entrepreneursCount
      activeCount
      liquidatedCount
    }
  }

  # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π query –¥–ª—è KPI
  statistics(filter: $filter) {
    totalCompanies
    totalEntrepreneurs
    activeCompanies
    activeEntrepreneurs
    liquidatedCompanies
    liquidatedEntrepreneurs
  }
}
```

#### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–í—Å–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤:**
```graphql
query {
  dashboardStatistics {
    regionHeatmap {
      regionCode
      regionName
      companiesCount
      activeCount
    }
  }
}
```

**–° —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ —Ä–µ–≥–∏–æ–Ω—É:**
```graphql
query {
  dashboardStatistics(filter: { regionCode: "77" }) {
    registrationsByMonth(
      dateFrom: "2024-01-01",
      dateTo: "2024-12-31"
    ) {
      month
      registrationsCount
      terminationsCount
      netGrowth
    }
  }
}
```

### Repository –∏ Service —Å–ª–æ–∏

**–§–∞–π–ª:** `services/api-gateway/internal/repository/clickhouse/statistics.go`

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

```go
// GetCompanyCounts - –ø–æ–¥—Å—á–µ—Ç –∫–æ–º–ø–∞–Ω–∏–π –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
func (r *StatisticsRepository) GetCompanyCounts(
    ctx context.Context,
    filter *model.StatsFilter,
) (*model.EntityCounts, error) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç stats_companies_by_region MV
    // –õ–æ–≥–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ company-status-badge.tsx
    baseQuery := `
        SELECT
            countMerge(count) as total,
            countMergeIf(count, status = 'active') as active,
            countMergeIf(count, status IN ('liquidated', 'bankrupt')) as liquidated
        FROM egrul.stats_companies_by_region
    `
}

// GetEntrepreneurCounts - –ø–æ–¥—Å—á–µ—Ç –ò–ü –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
func (r *StatisticsRepository) GetEntrepreneurCounts(
    ctx context.Context,
    filter *model.StatsFilter,
) (*model.EntityCounts, error) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç stats_entrepreneurs_by_region MV
    // –õ–æ–≥–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ entrepreneur-status-badge.tsx
    baseQuery := `
        SELECT
            countMerge(count) as total,
            countMergeIf(count, status = 'active') as active,
            countMergeIf(count, status = 'liquidated') as liquidated
        FROM egrul.stats_entrepreneurs_by_region
    `
}
```

## Frontend

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
frontend/src/
‚îú‚îÄ‚îÄ app/(dashboard)/analytics/
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx                               # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–∞—à–±–æ—Ä–¥–∞
‚îú‚îÄ‚îÄ components/analytics/
‚îÇ   ‚îú‚îÄ‚îÄ use-analytics-filters.ts               # –•—É–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ analytics-filters.tsx                  # –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ month-range-picker.tsx                 # –í—ã–±–æ—Ä –º–µ—Å—è—Ü–µ–≤ (–Ω–µ –¥–∞—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ kpi-cards.tsx                          # KPI –∫–∞—Ä—Ç–æ—á–∫–∏ (10 –∫–∞—Ä—Ç–æ—á–µ–∫: 5+5)
‚îÇ   ‚îú‚îÄ‚îÄ region-map-chart.tsx                   # –ö–∞—Ä—Ç–∞ —Ä–µ–≥–∏–æ–Ω–æ–≤ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º
‚îÇ   ‚îî‚îÄ‚îÄ registrations-timeline-chart.tsx       # –ì—Ä–∞—Ñ–∏–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
‚îî‚îÄ‚îÄ lib/api/
    ‚îú‚îÄ‚îÄ hooks.ts                               # TanStack Query hooks
    ‚îî‚îÄ‚îÄ queries/dashboard-statistics.graphql   # GraphQL queries
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. KPI Cards

**–§–∞–π–ª:** `frontend/src/components/analytics/kpi-cards.tsx`

–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –≤ –≤–∏–¥–µ –∫–∞—Ä—Ç–æ—á–µ–∫: **10 –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ 2 —Ä—è–¥–∞ –ø–æ 5 –∫–æ–ª–æ–Ω–æ–∫**

**–ü–µ—Ä–≤—ã–π —Ä—è–¥ (–ö–æ–º–ø–∞–Ω–∏–∏):**
1. –í—Å–µ–≥–æ –∫–æ–º–ø–∞–Ω–∏–π
2. –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏
3. –õ–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–æ (–Æ–õ) - –≤—Å–µ–≥–æ –≤ –±–∞–∑–µ
4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ (–Æ–õ) - –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
5. –õ–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–æ –∑–∞ –ø–µ—Ä–∏–æ–¥ (–Æ–õ) - –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥

**–í—Ç–æ—Ä–æ–π —Ä—è–¥ (–ò–ü):**
1. –í—Å–µ–≥–æ –ò–ü
2. –ê–∫—Ç–∏–≤–Ω—ã–µ –ò–ü
3. –õ–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–æ (–ò–ü) - –≤—Å–µ–≥–æ –≤ –±–∞–∑–µ
4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ (–ò–ü) - –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
5. –õ–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–æ –∑–∞ –ø–µ—Ä–∏–æ–¥ (–ò–ü) - –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Skeleton loading states
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª (`toLocaleString('ru-RU')`)
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ (`grid-cols-2 md:grid-cols-3 lg:grid-cols-5`)
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–π –∑–∞ –ø–µ—Ä–∏–æ–¥ –∏–∑ `terminationsCount`
- –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Ä—è–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–µ –ø–æ —Ç–∏–ø—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

#### 2. Region Map Chart

**–§–∞–π–ª:** `frontend/src/components/analytics/region-map-chart.tsx`

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Ö–æ—Ä–æ–ø–ª–µ—Ç-–∫–∞—Ä—Ç–∞ –†–æ—Å—Å–∏–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- Zoom –∏ pan (roam: true)
- Tooltips —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- –ö–ª–∏–∫ –ø–æ —Ä–µ–≥–∏–æ–Ω—É –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –¶–≤–µ—Ç–æ–≤–∞—è —à–∫–∞–ª–∞ (visualMap) –æ—Ç —Å–≤–µ—Ç–ª–æ–≥–æ –∫ —Ç–µ–º–Ω–æ–º—É
- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–µ–≥–∏–æ–Ω–∞ –ø—Ä–∏ hover
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å –≤—ã–¥–µ–ª–µ–Ω–∏—è** —á–µ—Ä–µ–∑ `selectedRegionCode` prop

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º —Ä–µ–≥–∏–æ–Ω–∞:**
```typescript
// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç selectedRegionCode prop
interface RegionMapChartProps {
  selectedRegionCode?: string;
  onRegionClick?: (regionCode: string) => void;
}

// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ref –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ ECharts instance
const chartRef = useRef<any>(null);

// useEffect —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Ñ–∏–ª—å—Ç—Ä–∞
useEffect(() => {
  if (!selectedRegionCode && chartRef.current) {
    const instance = chartRef.current.getEchartsInstance();
    if (instance) {
      instance.dispatchAction({
        type: 'unselect',
        seriesIndex: 0,
      });
    }
  }
}, [selectedRegionCode]);
```

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**
```typescript
{
  visualMap: {
    min: 0,
    max: maxValue,
    inRange: {
      color: ['#e0f2fe', '#0ea5e9', '#0369a1', '#075985', '#0c4a6e']
    }
  },
  series: [{
    type: 'map',
    map: 'russia',  // –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞ ECharts
    roam: true,
    emphasis: {
      itemStyle: { areaColor: '#fbbf24' }
    }
  }]
}
```

#### 3. Registrations Timeline Chart

**–§–∞–π–ª:** `frontend/src/components/analytics/registrations-timeline-chart.tsx`

–õ–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ —Å —Ç—Ä–µ–º—è –ª–∏–Ω–∏—è–º–∏:
- üü¢ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–∑–µ–ª–µ–Ω–∞—è)
- üî¥ –õ–∏–∫–≤–∏–¥–∞—Ü–∏–∏ (–∫—Ä–∞—Å–Ω–∞—è)
- üîµ –ü—Ä–∏—Ä–æ—Å—Ç (—Å–∏–Ω—è—è, —Å –∑–∞–ª–∏–≤–∫–æ–π)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Smooth curves (smooth: true)
- Cross-axis pointer –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π
- –õ–µ–≥–µ–Ω–¥–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç–∏—è –ª–∏–Ω–∏–π
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤—ã—Å–æ—Ç–∞ (350px)

#### 4. Analytics Filters

**–§–∞–π–ª:** `frontend/src/components/analytics/analytics-filters.tsx`

–ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å —á–µ—Ç—ã—Ä—å–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:
- –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–Æ–õ / –ò–ü / –í—Å–µ)
- –í—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞ (RegionSelect)
- –í—ã–±–æ—Ä –û–ö–í–≠–î (OkvedSelect)
- –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ (MonthRangePicker)
- –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage:**
```typescript
useEffect(() => {
  if (typeof window !== 'undefined') {
    localStorage.setItem('analytics-filters', JSON.stringify(filters));
  }
}, [filters]);
```

**–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:**
- –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ –±–µ–π–¥–∂–∏ –ø–æ–¥ –ø–∞–Ω–µ–ª—å—é —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –ö–∞–∂–¥—ã–π –±–µ–π–¥–∂ –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∫–ª–∏–∫–æ–º –Ω–∞ "X"

#### 5. Month Range Picker

**–§–∞–π–ª:** `frontend/src/components/analytics/month-range-picker.tsx`

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—ã–±–æ—Ä–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –º–µ—Å—è—Ü–µ–≤ (–Ω–µ –¥–∞—Ç!) –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í—ã–±–æ—Ä "—Å –º–µ—Å—è—Ü–∞" –∏ "–ø–æ –º–µ—Å—è—Ü" —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–µ Select
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–µ—Å—è—Ü–µ–≤
- –ö–Ω–æ–ø–∫–∞ "–°–±—Ä–æ—Å–∏—Ç—å" –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—ã–±–æ—Ä–∞
- –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å" –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞

**UI:**
- –ö–Ω–æ–ø–∫–∞ —Å –∏–∫–æ–Ω–∫–æ–π –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º
- Popover —Å –¥–≤—É–º—è –≥—Ä—É–ø–ø–∞–º–∏ Select (–º–µ—Å—è—Ü + –≥–æ–¥)
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞: "—è–Ω–≤. 2024 ‚Äî –¥–µ–∫. 2024"

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ React Hydration Error:**
```typescript
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞–∫ undefined –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è hydration mismatch
const [fromMonth, setFromMonth] = useState<number | undefined>(undefined);
const [fromYear, setFromYear] = useState<number | undefined>(undefined);

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å props –ø–æ—Å–ª–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ useEffect
useEffect(() => {
  setFromMonth(dateFrom ? dateFrom.getMonth() : undefined);
  setFromYear(dateFrom ? dateFrom.getFullYear() : undefined);
  setToMonth(dateTo ? dateTo.getMonth() : undefined);
  setToYear(dateTo ? dateTo.getFullYear() : undefined);
}, [dateFrom, dateTo]);
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç:**
```typescript
// –ü–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ "—Å"
newDateFrom = new Date(fromYear, fromMonth, 1);

// –ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ "–ø–æ" (23:59:59.999)
newDateTo = new Date(toYear, toMonth + 1, 0, 23, 59, 59, 999);
```

### React Hooks

#### useDashboardStatistics

**–§–∞–π–ª:** `frontend/src/lib/api/hooks.ts`

```typescript
export function useDashboardStatistics({
  filter,
  dateFrom,
  dateTo,
}: {
  filter?: StatsFilter;
  dateFrom?: Date;
  dateTo?: Date;
}) {
  return useQuery({
    queryKey: ['dashboard-statistics', filter, dateFrom, dateTo],
    queryFn: async () => {
      const response = await graphQLClient.request(
        GetDashboardStatisticsDocument,
        {
          filter: filter || {},
          dateFrom: dateFrom?.toISOString(),
          dateTo: dateTo?.toISOString(),
        }
      );
      return response;
    },
    staleTime: 5 * 60 * 1000, // 5 –º–∏–Ω—É—Ç –∫—ç—à
    retry: 2,
  });
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 5 –º–∏–Ω—É—Ç
- Retry –ª–æ–≥–∏–∫–∞ (2 –ø–æ–ø—ã—Ç–∫–∏)
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ queryKey –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏

#### useAnalyticsFilters

**–§–∞–π–ª:** `frontend/src/components/analytics/use-analytics-filters.ts`

```typescript
export function useAnalyticsFilters() {
  const [filters, setFilters] = useState<AnalyticsFilters>(() => {
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
    if (typeof window !== 'undefined') {
      const saved = localStorage.getItem('analytics-filters');
      if (saved) return JSON.parse(saved);
    }
    return {};
  });

  useEffect(() => {
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
    if (typeof window !== 'undefined') {
      localStorage.setItem('analytics-filters', JSON.stringify(filters));
    }
  }, [filters]);

  return { filters, setFilters, resetFilters };
}
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Backend –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **Materialized Views** - –ø—Ä–µ–¥–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - –ò–∑–±–µ–≥–∞–µ–º —Ç—è–∂–µ–ª—ã—Ö COUNT(*) –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
   - –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö

2. **AggregatingMergeTree** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
   - countState() –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è, countMerge() –¥–ª—è —á—Ç–µ–Ω–∏—è
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø—Ä–∏ —Å–ª–∏—è–Ω–∏–∏ –ø–∞—Ä—Ç

3. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Redis –∫—ç—à** (5 –º–∏–Ω—É—Ç TTL)
   ```go
   cacheKey := fmt.Sprintf("dashboard:stats:%s:%s:%s",
       filter.RegionCode, filter.Okved, filter.DateFrom)
   ```

### Frontend –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **TanStack Query –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - 5 –º–∏–Ω—É—Ç staleTime
2. **ECharts tree-shaking** - —Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
   ```typescript
   import { LineChart, MapChart } from 'echarts/charts';
   // –ù–ï: import * as echarts from 'echarts';
   ```
3. **Lazy loading –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   ```typescript
   const RegionMapChart = lazy(() => import('./region-map-chart'));
   ```

### –†–∞–∑–º–µ—Ä bundle

- ECharts –ø–æ—Å–ª–µ tree-shaking: ~150KB (gzip)
- –ö–∞—Ä—Ç–∞ –†–æ—Å—Å–∏–∏: –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ ECharts
- –û–±—â–∏–π –ø—Ä–∏—Ä–æ—Å—Ç bundle: ~180KB

## –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω

### Breakpoints

- **Mobile** (< 768px):
  - KPI cards: 1 –∫–æ–ª–æ–Ω–∫–∞
  - –ö–∞—Ä—Ç–∞: 300px –≤—ã—Å–æ—Ç–∞
  - –§–∏–ª—å—Ç—Ä—ã: –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫

- **Tablet** (768-1024px):
  - KPI cards: 2 –∫–æ–ª–æ–Ω–∫–∏
  - –ö–∞—Ä—Ç–∞: 400px –≤—ã—Å–æ—Ç–∞
  - –§–∏–ª—å—Ç—Ä—ã: –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å

- **Desktop** (> 1024px):
  - KPI cards: 3 –∫–æ–ª–æ–Ω–∫–∏
  - –ö–∞—Ä—Ç–∞: 500px –≤—ã—Å–æ—Ç–∞
  - –§–∏–ª—å—Ç—Ä—ã: –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å

### Touch-friendly

- –ö–∞—Ä—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç touch-to-zoom –∏ pan
- Tooltips –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ tap –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
- –§–∏–ª—å—Ç—Ä—ã –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è touch –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

## –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (a11y)

‚úÖ **Keyboard navigation**
- Tab, Enter, Space –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- Focus visible (Radix UI)

‚úÖ **ARIA labels**
- –ì—Ä–∞—Ñ–∏–∫–∏ –∏–º–µ—é—Ç aria-label
- –ö–Ω–æ–ø–∫–∏ –∏ –∏–Ω–ø—É—Ç—ã –∏–º–µ—é—Ç aria-label/aria-labelledby

‚úÖ **Screen reader support**
- ECharts ARIA –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
- –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π HTML

‚úÖ **–ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å**
- –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏
- WCAG AA compliance

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. ClickHouse –∫–ª–∞—Å—Ç–µ—Ä –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ 013 –∏ 018
3. –î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã

### –ö–æ–º–∞–Ω–¥—ã

```bash
# 1. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ë–î —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π (011-018)
make cluster-reset

# 2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º MV
make cluster-import

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å frontend dev server
cd frontend && pnpm dev

# 4. –û—Ç–∫—Ä—ã—Ç—å –¥–∞—à–±–æ—Ä–¥
# http://localhost:3000/analytics
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- `make cluster-reset` –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ 011, 012, 013, 014, 015, 016, 017, 018
- `make cluster-import` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `make cluster-fill-mv` –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è Materialized Views
- –ú–∏–≥—Ä–∞—Ü–∏—è 018 –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏–∫—É MV –¥–ª—è –ª–∏–∫–≤–∏–¥–∞—Ü–∏–π (COALESCE + status_code)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

**1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å MV –≤ ClickHouse:**
```sql
-- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–∞–Ω–Ω—ã–µ
SELECT status, countMerge(count) as total
FROM egrul.stats_companies_by_region
GROUP BY status;

-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
-- active:      ~182,847
-- liquidated:  ~26,685
-- bankrupt:    –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ liquidated
```

**2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å GraphQL API:**
```graphql
query {
  dashboardStatistics {
    regionHeatmap {
      regionCode
      regionName
      companiesCount
    }
  }
}
```

**3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å frontend:**
- –û—Ç–∫—Ä—ã—Ç—å http://localhost:3000/analytics
- –í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è
- –§–∏–ª—å—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å
- –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç—É –¥–æ–ª–∂–µ–Ω —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Batch updates MV** - –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–º –∏–º–ø–æ—Ä—Ç–µ MV –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∞
2. **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç MV –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å—á–µ—Ç)
3. **Bundle size** - ECharts –¥–æ–±–∞–≤–ª—è–µ—Ç ~180KB –∫ bundle (trade-off –∑–∞ –±–æ–≥–∞—Ç—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **React Hydration Error #418** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - –ü—Ä–æ–±–ª–µ–º–∞: MonthRangePicker –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª useState –∏–∑ props, –≤—ã–∑—ã–≤–∞—è –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SSR/client
   - –†–µ—à–µ–Ω–∏–µ: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–∫ `undefined`, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ useEffect –ø–æ—Å–ª–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

2. **–†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤ —Ü–∏—Ñ—Ä–∞—Ö –ª–∏–∫–≤–∏–¥–∞—Ü–∏–π** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –º–∏–≥—Ä–∞—Ü–∏–µ–π 018
   - –ü—Ä–æ–±–ª–µ–º–∞: MV –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ —Ç–æ–ª—å–∫–æ `WHERE termination_date IS NOT NULL`, –ø—Ä–æ–ø—É—Å–∫–∞—è –∫–æ–º–ø–∞–Ω–∏–∏ —Å–æ status_code
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å COALESCE –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π status_code —Å–æ–≥–ª–∞—Å–Ω–æ Makefile

3. **–°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–∞ –Ω–µ –æ—á–∏—â–∞–ª –∫–∞—Ä—Ç—É** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ selectedRegionCode prop
   - –ü—Ä–æ–±–ª–µ–º–∞: ECharts —Å–æ—Ö—Ä–∞–Ω—è–ª –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è
   - –†–µ—à–µ–Ω–∏–µ: ref + useEffect + dispatchAction('unselect') –ø—Ä–∏ —Å–±—Ä–æ—Å–µ —Ñ–∏–ª—å—Ç—Ä–∞

## –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

### –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö

1. **–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö**
   - PDF –æ—Ç—á—ë—Ç —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ (jspdf + html2canvas)
   - Excel —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (xlsx)

2. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã**
   - Pie chart —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ –û–ü–§
   - Bar chart —Ç–æ–ø –æ—Ç—Ä–∞—Å–ª–µ–π –ø–æ –û–ö–í–≠–î
   - Bar chart —Å—Ä–µ–¥–Ω–µ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞ –ø–æ –æ—Ç—Ä–∞—Å–ª—è–º

3. **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã**
   - –î–∏–∞–ø–∞–∑–æ–Ω –∫–∞–ø–∏—Ç–∞–ª–∞ (min/max)
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–æ–≤
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤ (year-over-year)

4. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**
   - Drill-down —Å –∫–∞—Ä—Ç—ã –≤ –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
   - –ö—Ä–æ—Å—Å-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–µ–∂–¥—É –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
   - Bookmarks (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –¥–∞—à–±–æ—Ä–¥–∞)

## –°—Å—ã–ª–∫–∏

- [–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](/Users/konstantin/.claude/plans/polished-percolating-cat.md)
- [–ú–∏–≥—Ä–∞—Ü–∏—è 013](../infrastructure/migrations/clickhouse/cluster/013_update_mv_status_logic.sql) - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤
- [–ú–∏–≥—Ä–∞—Ü–∏—è 018](../infrastructure/migrations/clickhouse/cluster/018_fix_terminations_mv_logic.sql) - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–π
- [GraphQL Schema](../services/api-gateway/internal/graph/schema.graphqls)
- [Statistics Repository](../services/api-gateway/internal/repository/clickhouse/statistics.go)
- [Frontend Page](../frontend/src/app/(dashboard)/analytics/page.tsx)
- [Month Range Picker](../frontend/src/components/analytics/month-range-picker.tsx)
- [KPI Cards](../frontend/src/components/analytics/kpi-cards.tsx)

## –ö–æ–Ω—Ç—Ä–∏–±—å—é—Ç–æ—Ä—ã

- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è backend: –º–∏–≥—Ä–∞—Ü–∏—è 013, GraphQL API, repository/service —Å–ª–æ–∏
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è frontend: React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, ECharts –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, —Ñ–∏–ª—å—Ç—Ä—ã
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: ANALYTICS_DASHBOARD.md

---

**–í–µ—Ä—Å–∏—è:** 1.1.0
**–î–∞—Ç–∞:** 2025-02-11
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≤–µ—Ä—Å–∏–∏ 1.1.0:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è 018 –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–π
- KPI –∫–∞—Ä—Ç–æ—á–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–æ 10 (5+5) —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º grid 2/3/5
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ "–õ–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–æ –∑–∞ –ø–µ—Ä–∏–æ–¥"
- –ó–∞–º–µ–Ω–∞ DateRangePicker –Ω–∞ MonthRangePicker –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–µ—Å—è—Ü–µ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω React Hydration Error #418
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º —Å–±—Ä–æ—Å–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ä–µ–≥–∏–æ–Ω–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
- –£–ª—É—á—à–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å –∫–∞—Ä—Ç–æ–π —á–µ—Ä–µ–∑ selectedRegionCode prop
